// (c) 2007 Blue Sky Minds Pty Ltd

if(typeof blueskyminds=='undefined'){var blueskyminds={};}
blueskyminds.namespace=function(namespaces){var args=arguments;var packageNames;var currentNamespace;for(var i=0;i<args.length;i++){currentNamespace=window;packageNames=args[i].split('.');for(var j=0;j<packageNames.length;j++){if(!currentNamespace[packageNames[j]]){currentNamespace[packageNames[j]]={};}
currentNamespace=currentNamespace[packageNames[j]];}}
return currentNamespace;};blueskyminds.log=function(){function eventsLoaded(){return(typeof blueskyminds.events.log!='undefined');}
return{debug:function(message){if(eventsLoaded()){blueskyminds.events.log.debug(message);}},info:function(message){if(eventsLoaded()){blueskyminds.events.log.info(message);}},error:function(message){if(eventsLoaded()){blueskyminds.events.log.error(message);}}};}();blueskyminds.namespace("blueskyminds.dom");blueskyminds.dom.escapeHTML=function(text,preserveBreaks){if(text){var result=text.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;");if(preserveBreaks){result=result.replace(/\n/,"<br/>");}
return result;}else{return null;}};blueskyminds.dom.resolveReference=function(idOrNode){var el;if(YAHOO.lang.isObject(idOrNode)){el=idOrNode;}else{if(YAHOO.lang.isString(idOrNode)){el=document.getElementById(idOrNode);}}
return el;};blueskyminds.dom.insertHTML=function(idOrElement,text,dontEscape){var el=blueskyminds.dom.resolveReference(idOrElement);if(el){var escaped=(dontEscape?text:blueskyminds.dom.escapeHTML(text));if(escaped){el.innerHTML=escaped;}else{blueskyminds.dom.clearHTML(el);}}};blueskyminds.dom.appendHTML=function(idOrElement,tagName,text,dontEscape){var el=blueskyminds.dom.resolveReference(idOrElement);if(el){var escaped=(dontEscape?text:blueskyminds.dom.escapeHTML(text));if(escaped){var sibling=document.createElement(tagName);sibling.innerHTML=escaped;el.appendChild(sibling);}}};blueskyminds.dom.clearHTML=function(el){while(el.firstChild){el.removeChild(el.firstChild);}};blueskyminds.namespace("blueskyminds");blueskyminds.events=function(){var eventMap={};var EventProxy=function(eventName){var subscribers=[];var SubscriberRef=function(callback,context){this.callback=callback;this.context=context;};return{isProxy:true,subscribe:function(callback,context){subscribers[subscribers.length]=new SubscriberRef(callback,context);},fire:function(args){},subscribers:function(){return subscribers;}};};function replaceProxy(eventName,proxy,event){eventMap[eventName]=event;for(var subscriber in proxy.subscribers())if(proxy.hasOwnProperty(subscriber)){event.subscribe(subscriber.callback,subscriber.context);}
blueskyminds.log.debug(eventName+" event proxy replaced");}
function createProxy(eventName){var proxy=new EventProxy(eventName);eventMap[eventName]=proxy;blueskyminds.log.debug(eventName+" event proxy registered");return proxy;}
function getEvent(eventName){var event=eventMap[eventName];if(!event){return createProxy(eventName);}else{return event;}}
function setEvent(eventName,event){var existing=eventMap[eventName];if(!existing){eventMap[eventName]=event;blueskyminds.log.debug(eventName+" event registered");}else{if(existing.isProxy){replaceProxy(eventName,existing,event);}else{eventMap[eventName]=event;}}}
function init(){eventMap.debug=new YAHOO.util.CustomEvent("debug");eventMap.info=new YAHOO.util.CustomEvent("info");eventMap.error=new YAHOO.util.CustomEvent("error");}
init();return{register:function(eventName,event){setEvent(eventName,event);},subscribe:function(eventName,callback,context){var event=getEvent(eventName);event.subscribe(callback,context);},fire:function(eventName,args){var event=getEvent(eventName);if(event){event.fire(args);blueskyminds.log.debug(eventName+" event fired");}},log:{debug:function(message){var event=getEvent('logDebug');if(event){event.fire(message);}},info:function(message){var event=getEvent('logInfo');if(event){event.fire(message);}},error:function(message){var event=getEvent('logError');if(event){event.fire(message);}}}};}();blueskyminds.namespace("blueskyminds.net","blueskyminds.net.json");blueskyminds.net.json.evaluate=function(response){var obj=null;if(response){if((response.indexOf("/*")>=0)&&(response.lastIndexOf("*/")>=0)){try{obj=eval("("+response.substring(response.indexOf("/*")+2,response.lastIndexOf("*/"))+")");}catch(ex){blueskyminds.log.error("Exception evaluating JSON-commented response"+ex);}}else{try{obj=eval("("+response+")");}catch(ex2){blueskyminds.log.error("Exception evaluating JSON response"+ex2);}}}
return obj;};blueskyminds.net.errorMessage=function(o){var result=null;if(o){switch(o.status){case 0:result="Unable to contact the server: communication error";break;case-1:result="Transaction aborted";break;default:result="The server reported an error: "+o.status;break;}}else{result="Invalid server response";}
return result;};blueskyminds.namespace("blueskyminds.ui","blueskyminds.ui.datatable");blueskyminds.ui.MessageConsole=function(containerId){var container;function init(){container=document.getElementById(containerId);}
init();return{clear:function(){blueskyminds.dom.clearHTML(container);},println:function(message){blueskyminds.dom.appendHTML(container,'div',message);},print:function(message){blueskyminds.dom.appendHTML(container,'span',message);},isEnabled:function(){return container!==null;}};};blueskyminds.ui.Logger=function(containerId){var msgConsole;function log(method,message){if(YAHOO.lang.isString(message)){method(message);}else{if(message.length>0){for(var i=0;i<message.length;i++){method(message[i]);}}}}
function debug(message){msgConsole.println("debug:"+message);}
function info(message){msgConsole.println("info:"+message);}
function error(message){msgConsole.println("error:"+message);}
function onDebug(type,args,context){log(debug,args);}
function onInfo(type,args,context){log(info,args);}
function onError(type,args,context){log(error,args);}
function init(){msgConsole=new blueskyminds.ui.MessageConsole(containerId);blueskyminds.events.subscribe("logDebug",onDebug);blueskyminds.events.subscribe("logInfo",onInfo);blueskyminds.events.subscribe("logError",onError);log(info,"Logger started");}
init();return{debug:function(message){log(debug,message);},info:function(message){log(info,message);},error:function(message){log(error,message);}};};blueskyminds.ui.ProgressIndicatorController=function(indicatorId,startEventName,stopEventName){function onStart(type,args,context){var indicator=document.getElementById(indicatorId);if(indicator){indicator.style.display="inline";}}
function onStop(type,args,context){var indicator=document.getElementById(indicatorId);if(indicator){indicator.style.display="none";}}
blueskyminds.events.subscribe(startEventName,onStart);blueskyminds.events.subscribe(stopEventName,onStop);};blueskyminds.ui.ErrorController=function(errorContainerId,errorEventName,optCallback,optTemplate){var containerId=errorContainerId;function errorCallback(type,args,context){var paraBody=args[0];var container=document.getElementById(containerId);if(container){if(optCallback){var node=optCallback(paraBody);container.appendChild(node);}else{if(optTemplate){var templateContext={message:paraBody};var html=optTemplate.process(templateContext);blueskyminds.dom.insertHTML(containerId,html,true);container.style.display='block';}else{blueskyminds.dom.insertHTML(containerId,paraBody);container.style.display='block';}}}}
blueskyminds.events.register(errorEventName,new YAHOO.util.CustomEvent(errorEventName,this));blueskyminds.events.subscribe(errorEventName,errorCallback,null);return{dismissErrors:function(){var container=document.getElementById(containerId);if(container){blueskyminds.dom.clearHTML(container);}}};};blueskyminds.ui.decorators=function(){return{decorate:function(){var divs=document.getElementsByTagName('div');}};}();blueskyminds.namespace("FreemarkerTool");FreemarkerTool.constants={FORM_ID:"templateForm",OPEN_CONTAINER_ID:"openContainer",OPEN_CONTAINER_BOX_ID:"openContainerBox",OPEN_TEXT_ID:"open",CLOSE_CONTAINER_ID:"closeContainer",CLOSE_CONTAINER_BOX_ID:"closeContainerBox",CLOSE_TEXT_ID:"close",BODY_TEXT_CONTAINER_ID:"bodyTextContainer",BODY_TEXT_CONTAINER_BOX_ID:"bodyTextContainerBox",BODY_TEXT_ID:"bodyText",OUTPUT_TEXT_CONTAINER_ID:"outputTextContainer",OUTPUT_TEXT_ID:"outputText",ERROR_ID:"errorContainer",INDICATOR_ID:"indicator",TOGGLE_VIEW_BTN_ID:"toggleViewBtnGroup",OPEN_TITLE_TEMPLATE_ID:"openTitleTemplate",OPEN_TITLE_TAG_ID:"openTitleTag"};FreemarkerTool.ui=function(){var CHANGE_TIMEOUT=1000;var TICK_INTERVAL=250;var ERROR_EVENT="error";var errorController;var idleTimer;var indicatorController;var openTextController;var closingTextController;var bodyTextController;var inputChanged=false;var contextFields;var IdleTimer=function(tickInterval,millisToWait,callback){var tickCounter;var lastFired;var ticksToWait;function tickListener(){tickCounter++;if(tickCounter-lastFired>ticksToWait){callback();lastFired=tickCounter;}}
function init(){tickCounter=0;lastFired=0;ticksToWait=(millisToWait/tickInterval);setInterval(tickListener,tickInterval);}
init();return{reset:function(){tickCounter=0;lastFired=0;}};};var TextInputController=function(id,containerId,callback){var container=containerId;var elementId=id;var element;function onChangeListener(e){callback();}
function onFocusListener(e){YAHOO.util.Dom.setStyle(container,"background-color","#ffffe8");}
function onBlurListener(e){YAHOO.util.Dom.setStyle(container,"background-color","white");}
element=new YAHOO.util.Element(id);element.on('keyup',onChangeListener);element.on('keydown',onChangeListener);element.on('keypress',onChangeListener);element.on('focus',onFocusListener);element.on('blur',onBlurListener);return{setContent:function(text){var el=document.getElementById(elementId);if(el){if(text){el.value=text;}else{el.value="";}}}};};function setFreemarkerOutput(text){var el=document.getElementById(FreemarkerTool.constants.OUTPUT_TEXT_ID);if(el){el.value=text;}}
function clearInputChangedFlag(){inputChanged=false;}
function setInputChangedFlag(){inputChanged=true;}
function isInputChanged(){return inputChanged;}
function inputChangedListener(){idleTimer.reset();setInputChangedFlag();}
function showIndicator(){blueskyminds.events.fire("startedParsing");}
function hideIndicator(){blueskyminds.events.fire("stoppedParsing");}
var parseCallback={success:function(o){hideIndicator();var payload=blueskyminds.net.json.evaluate(o.responseText);if(payload){if(payload.exception){blueskyminds.events.fire(ERROR_EVENT,payload.exception.message);}else{setFreemarkerOutput(payload.result);}}else{blueskyminds.events.fire(ERROR_EVENT,"Invalid response received from the server");}},failure:function(o){hideIndicator();blueskyminds.events.fire(ERROR_EVENT,blueskyminds.net.errorMessage(o));}};function parseTemplate(){var formEl=document.getElementById(FreemarkerTool.constants.FORM_ID);FreemarkerTool.ui.dismissErrors();if(formEl){YAHOO.util.Connect.setForm(formEl);showIndicator();YAHOO.util.Connect.asyncRequest('POST',formEl.action,parseCallback);}else{blueskyminds.events.fire(ERROR_EVENT,"Form '"+FreemarkerTool.constants.FORM_ID+"' is missing");}}
function idleCallback(){if(isInputChanged()){clearInputChangedFlag();parseTemplate();}}
var CONTEXT_CONTAINER_ID="context[{0}].container";var PARENT_CONTEXT_CONTAINER_ID="contextContainer";var CONTEXT_TEMPLATE_ID="contextFieldTemplate";var CONTEXT_ENABLED_CHECKBOX_ID="context[{0}].enabled";var CONTEXT_NAME_TEXT_ID="context[{0}].name";var CONTEXT_VALUE_TEXT_ID="context[{0}].value";var CONTEXT_VALUE_NULL_CHECKBOX_ID="context[{0}].nullValue";var contextFieldTemplate;var contextFieldCount;var ContextField=function(fieldIndex,onFocusListener,onChangeListener){var index=fieldIndex;var containerEl;var enabledEl;var nameEl;var valueEl;var nullEl;var nameElId;var valueElId;var lastValue="";var focusListener=onFocusListener;var changeListener=onChangeListener;function fireFocusListener(){if(focusListener){focusListener(index);}}
function fireChangeListener(){if(changeListener){changeListener(index);}}
function setEnabledFlag(enabled){if(enabled){enabledEl.set('checked',true);enabledEl.set('value',"true");}else{enabledEl.set('checked',false);enabledEl.set('value',"false");}}
function isEnabled(){return enabledEl.get('checked');}
function isNull(){return nullEl.get('checked');}
function setNullFlag(nullFlag){if(nullFlag){nullEl.set('checked',true);nullEl.set('value',"true");}else{nullEl.set('checked',false);nullEl.set('value',"false");}}
function setNullValue(checked){setNullFlag(checked);if(checked){valueEl.addClass('disabled');if(lastValue===null){var value=valueEl.get('element').value;lastValue=(value?value:"");valueEl.set('value',"< null >");}}else{valueEl.removeClass('disabled');if(lastValue!==null){valueEl.set('value',lastValue);lastValue=null;}}}
function enable(){setEnabledFlag(true);containerEl.removeClass("disabled");containerEl.addClass("enabled");nameEl.removeClass('disabled');nullEl.removeClass('disabled');setNullValue(isNull());}
function disable(){setEnabledFlag(false);containerEl.removeClass("enabled");containerEl.addClass("disabled");nameEl.addClass('disabled');valueEl.addClass('disabled');nullEl.addClass('disabled');}
function idOf(template){return YAHOO.Tools.printf(template,index);}
function onEnabledChange(e){if(e.target.checked){enable();fireFocusListener();}else{disable();}
fireChangeListener();}
function clearName(){nameEl.set('value',"");}
function clearValue(){valueEl.set('value',"");}
function onNameChange(e){enable();fireChangeListener();}
function onNameFocus(e){enable();YAHOO.util.Dom.addClass(nameElId,"focus");fireFocusListener();}
function onNameBlur(e){YAHOO.util.Dom.removeClass(nameElId,"focus");}
function onValueChange(e){enable();fireChangeListener();}
function onValueFocus(e){enable();YAHOO.util.Dom.addClass(nameElId,"focus");fireFocusListener();}
function onValueBlur(e){YAHOO.util.Dom.removeClass(nameElId,"focus");}
function onNullChange(e){setNullValue(e.target.checked);enable();fireFocusListener();fireChangeListener();}
function reset(){if(isEnabled()){enable();}else{disable();}}
function init(){containerEl=new YAHOO.util.Element(idOf(CONTEXT_CONTAINER_ID));enabledEl=new YAHOO.util.Element(idOf(CONTEXT_ENABLED_CHECKBOX_ID));nameElId=idOf(CONTEXT_NAME_TEXT_ID);nameEl=new YAHOO.util.Element(nameElId);valueElId=idOf(CONTEXT_VALUE_TEXT_ID);valueEl=new YAHOO.util.Element(valueElId);nullEl=new YAHOO.util.Element(idOf(CONTEXT_VALUE_NULL_CHECKBOX_ID));if(enabledEl){enabledEl.on('click',onEnabledChange);}
if(nameEl){nameEl.on('keyup',onNameChange);nameEl.on('keydown',onNameChange);nameEl.on('keypress',onNameChange);nameEl.on('focus',onNameFocus);nameEl.on('blur',onNameBlur);nameEl.on('click',onNameFocus);}
if(valueEl){valueEl.on('keyup',onValueChange);valueEl.on('keydown',onValueChange);valueEl.on('keypress',onValueChange);valueEl.on('focus',onValueFocus);valueEl.on('blur',onValueBlur);valueEl.on('click',onValueFocus);}
if(nullEl){nullEl.on('click',onNullChange);}
reset();}
init();return{isEnabled:function(){if(enabledEl){return enabledEl.checked;}else{return false;}},clear:function(){disable();clearName();clearValue();setNullFlag(false);},setName:function(name){nameEl.set('value',name);},setValue:function(value){valueEl.set('value',value);},setNullValue:function(isNull){setNullFlag(isNull);lastValue=null;},setEnabled:function(enabled){if(enabled){enable();}else{disable();}}};};function onContextFieldFocus(itemNo){if(itemNo==contextFields.length-1){createContextField(itemNo+1);}}
function onContextFieldChange(itemNo){idleTimer.reset();setInputChangedFlag();}
function prepareInput(id,idTemplate,type,className){var eTD=YAHOO.util.Dom.create("td");var idValue=YAHOO.tools.printf(idTemplate,id);var eInput=YAHOO.util.Dom.create("input",{id:idValue,type:type,className:className,name:idValue});eTD.appendChild(eInput);return eTD;}
function createContextField(){var templateContext={index:contextFieldCount};var nodeId=YAHOO.tools.printf(CONTEXT_CONTAINER_ID,templateContext.index);var node=document.getElementById(nodeId);if(!node){node=YAHOO.util.Dom.create("tr",{id:nodeId,className:"contextField"});node.appendChild(prepareInput(templateContext.index,CONTEXT_ENABLED_CHECKBOX_ID,"checkbox",""));node.appendChild(prepareInput(templateContext.index,CONTEXT_NAME_TEXT_ID,"text","name"));node.appendChild(prepareInput(templateContext.index,CONTEXT_VALUE_TEXT_ID,"text","value"));node.appendChild(prepareInput(templateContext.index,CONTEXT_VALUE_NULL_CHECKBOX_ID,"checkbox",""));var parent=document.getElementById(PARENT_CONTEXT_CONTAINER_ID);parent.appendChild(node);contextFields[templateContext.index]=new ContextField(templateContext.index,onContextFieldFocus,onContextFieldChange);}else{contextFields[templateContext.index].clear();}
contextFieldCount++;return contextFields[templateContext.index];}
function initContext(){contextFields=[];contextFieldCount=0;var elements=YAHOO.util.Dom.getElementsByClassName("contextField");var parentNode;for(var itemNo=0;itemNo<elements.length;itemNo++){parentNode=elements[itemNo].parentNode;parentNode.removeChild(elements[itemNo]);}
createContextField(0);}
function prepareErrorNode(message){var eDiv=YAHOO.util.Dom.create("div",{className:"block"});eDiv.appendChild(YAHOO.util.Dom.create("h2",{},[YAHOO.util.Dom.create("span",{},"Error:")]));var eBox=YAHOO.util.Dom.create("div",{className:"borderbox"});var ebbt=YAHOO.util.Dom.create("div",{className:"borderboxtop"},[YAHOO.util.Dom.create("div")]);eBox.appendChild(ebbt);var eContent=YAHOO.util.Dom.create("div",{className:"borderboxcontent"});var eBtnDiv=YAHOO.util.Dom.create("div",{className:"closeBtn"},[YAHOO.util.Dom.create("a",{title:"Dismiss Errors",onclick:"FreemarkerTool.ui.dismissErrors();return false"},[YAHOO.util.Dom.create("span",{},"dismiss")])]);eContent.appendChild(eBtnDiv);eContent.appendChild(YAHOO.util.Dom.create("p",{},message));eBox.appendChild(eContent);var ebbb=YAHOO.util.Dom.create("div",{className:"borderboxbot"},[YAHOO.util.Dom.create("div")]);eBox.appendChild(ebbb);eDiv.appendChild(eBox);return eDiv;}
function init(){FreemarkerTool.layout.init();errorController=new blueskyminds.ui.ErrorController(FreemarkerTool.constants.ERROR_ID,ERROR_EVENT,prepareErrorNode);idleTimer=new IdleTimer(TICK_INTERVAL,CHANGE_TIMEOUT,idleCallback);openTextController=new TextInputController(FreemarkerTool.constants.OPEN_TEXT_ID,FreemarkerTool.constants.OPEN_CONTAINER_BOX_ID,inputChangedListener);bodyTextController=new TextInputController(FreemarkerTool.constants.BODY_TEXT_ID,FreemarkerTool.constants.BODY_TEXT_CONTAINER_BOX_ID,inputChangedListener);closingTextController=new TextInputController(FreemarkerTool.constants.CLOSE_TEXT_ID,FreemarkerTool.constants.CLOSE_CONTAINER_BOX_ID,inputChangedListener);blueskyminds.events.register("startedParsing",new YAHOO.util.CustomEvent("startedParsing"));blueskyminds.events.register("stoppedParsing",new YAHOO.util.CustomEvent("stoppedParsing"));indicatorController=new blueskyminds.ui.ProgressIndicatorController(FreemarkerTool.constants.INDICATOR_ID,"startedParsing","stoppedParsing");initContext();var openText=document.getElementById(FreemarkerTool.constants.OPEN_TEXT_ID);openText.blur();openText.select();openText.focus();}
YAHOO.util.Event.onDOMReady(init);return{dismissErrors:function(){errorController.dismissErrors();},setViewMode:function(template){FreemarkerTool.layout.setTemplateView(template);},setOpenTemplate:function(content){openTextController.setContent(content);},setBodyText:function(content){bodyTextController.setContent(content);},setCloseTemplate:function(content){closingTextController.setContent(content);},clearContext:function(){for(var i=0;i<contextFieldCount;i++){contextFields[i].clear();}
contextFieldCount=0;},addContextItem:function(enabled,name,value,isNullValue){var contextField=createContextField();contextField.setNullValue(isNullValue);contextField.setName(name);contextField.setValue(value);contextField.setEnabled(enabled);},parseTemplates:function(){parseTemplate();}};}();FreemarkerTool.ExampleLoader=function(){var ERROR_EVENT="error";var START_LOADING_EVENT="loadingExample";var STOP_LOADING_EVENT="loadedExample";var INDICATOR_ID="exampleIndicator";var EXAMPLE_ID="examples";var EXAMPLE_URL="/example.json";var indicatorController;function showIndicator(){blueskyminds.events.fire(START_LOADING_EVENT);}
function hideIndicator(){blueskyminds.events.fire(STOP_LOADING_EVENT);}
var exampleCallback={success:function(o){hideIndicator();var payload=blueskyminds.net.json.evaluate(o.responseText);if(payload){if(payload.exception){blueskyminds.events.fire(ERROR_EVENT,payload.exception.message);}else{var example=payload.example;if(example){FreemarkerTool.ui.setViewMode(example.templateView);FreemarkerTool.ui.setOpenTemplate(example.openTemplate);FreemarkerTool.ui.setBodyText(example.bodyText);FreemarkerTool.ui.setCloseTemplate(example.closeTemplate);FreemarkerTool.ui.clearContext();if(payload.example.context){for(var i=0;i<example.context.length;i++){var contextField=example.context[i];FreemarkerTool.ui.addContextItem(contextField.enabled,contextField.name,contextField.value,contextField.nullValue);}}
FreemarkerTool.ui.parseTemplates();}else{blueskyminds.events.fire(ERROR_EVENT,"The requested example couldn't be loaded by the server");}}}else{blueskyminds.events.fire(ERROR_EVENT,"Invalid response received from the server");}},failure:function(o){hideIndicator();blueskyminds.events.fire(ERROR_EVENT,blueskyminds.net.errorMessage(o));}};function onSelection(eventInfo){var el=document.getElementById(EXAMPLE_ID);if(el){var index=el.selectedIndex;if(index){showIndicator();YAHOO.util.Connect.resetFormState();YAHOO.util.Connect.setForm("exampleForm");YAHOO.util.Connect.asyncRequest('GET',EXAMPLE_URL+"?id="+index,exampleCallback);}}}
function init(){YAHOO.util.Event.addListener(EXAMPLE_ID,'change',onSelection);blueskyminds.events.register(START_LOADING_EVENT,new YAHOO.util.CustomEvent(START_LOADING_EVENT));blueskyminds.events.register(STOP_LOADING_EVENT,new YAHOO.util.CustomEvent(STOP_LOADING_EVENT));indicatorController=new blueskyminds.ui.ProgressIndicatorController(INDICATOR_ID,START_LOADING_EVENT,STOP_LOADING_EVENT);}
YAHOO.util.Event.onDOMReady(init);return{clearSelection:function(){var el=document.getElementById(EXAMPLE_ID);if(el){el.selectedIndex=0;}}};}();FreemarkerTool.layout=function(){var CONTEXT_PANEL_ID="contextPanel";var BORDER=10;var HEADER_HEIGHT=100;var CONTENT_VPADDING=BORDER*2;var VOVERFLOW=20;var FOOTER_HEIGHT=20;var PANEL_MARGIN=BORDER*2+23;var SETTINGS_HEIGHT=68;var toggleButton;var templateMode;function resetHeights(){var viewPortHeight=YAHOO.util.Dom.getViewportHeight();var availableHeight;if(YAHOO.tools.getBrowserEngine().msie){availableHeight=viewPortHeight-HEADER_HEIGHT-(4*BORDER)-FOOTER_HEIGHT-CONTENT_VPADDING-VOVERFLOW;}else{availableHeight=viewPortHeight-HEADER_HEIGHT-FOOTER_HEIGHT-CONTENT_VPADDING-VOVERFLOW;}
var openHeight;var bodyTextHeight;var closeHeight;var outputHeight;if(templateMode){closeHeight=0;bodyTextHeight=0;openHeight=availableHeight/2;outputHeight=availableHeight-openHeight;YAHOO.util.Dom.setStyle(FreemarkerTool.constants.BODY_TEXT_CONTAINER_ID,"display","none");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.CLOSE_CONTAINER_ID,"display","none");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_TITLE_TAG_ID,"display","none");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_TITLE_TEMPLATE_ID,"display","block");document.getElementById(FreemarkerTool.constants.BODY_TEXT_ID).disabled=true;document.getElementById(FreemarkerTool.constants.CLOSE_TEXT_ID).disabled=true;YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_CONTAINER_ID,"height",openHeight+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_TEXT_ID,"height",(openHeight-PANEL_MARGIN)+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OUTPUT_TEXT_CONTAINER_ID,"height",outputHeight+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OUTPUT_TEXT_ID,"height",(outputHeight-PANEL_MARGIN)+"px");}else{bodyTextHeight=60;closeHeight=0;openHeight=(availableHeight-bodyTextHeight)/3;closeHeight=openHeight;outputHeight=availableHeight-openHeight-bodyTextHeight-closeHeight;document.getElementById(FreemarkerTool.constants.BODY_TEXT_ID).disabled=false;document.getElementById(FreemarkerTool.constants.CLOSE_TEXT_ID).disabled=false;YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_TITLE_TEMPLATE_ID,"display","none");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_TITLE_TAG_ID,"display","block");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_TEXT_ID,"height",(openHeight-PANEL_MARGIN)+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OPEN_CONTAINER_ID,"height",openHeight+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.BODY_TEXT_CONTAINER_ID,"display","block");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.BODY_TEXT_CONTAINER_ID,"height",bodyTextHeight+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.CLOSE_TEXT_ID,"height",(closeHeight-PANEL_MARGIN)+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.CLOSE_CONTAINER_ID,"display","block");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.CLOSE_CONTAINER_ID,"height",closeHeight+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OUTPUT_TEXT_ID,"height",(outputHeight-PANEL_MARGIN)+"px");YAHOO.util.Dom.setStyle(FreemarkerTool.constants.OUTPUT_TEXT_CONTAINER_ID,"height",outputHeight+"px");}
var ePanel=document.getElementById("mainPanel");var eSettings=document.getElementById("settings");var rightHeight=(ePanel.offsetHeight-CONTENT_VPADDING);var contextHeight=rightHeight-eSettings.offsetHeight;YAHOO.util.Dom.setStyle("right","height",rightHeight+"px");YAHOO.util.Dom.setStyle(CONTEXT_PANEL_ID,"height",(contextHeight-PANEL_MARGIN)+"px");}
function toggleView(eventInfo){if(this.get('checkedButton').index===0){templateMode=true;}else{templateMode=false;}
resetHeights();document.getElementById(FreemarkerTool.constants.OPEN_TEXT_ID).focus();}
function onResizeListener(e){resetHeights();}
function initLayout(){toggleButton=new YAHOO.widget.ButtonGroup(FreemarkerTool.constants.TOGGLE_VIEW_BTN_ID);toggleButton.addListener("checkedButtonChange",toggleView);FreemarkerTool.layout.setTemplateView(true);YAHOO.util.Event.addListener(window,'resize',onResizeListener);}
return{init:function(){initLayout();},reset:function(){resetHeights();},setTemplateView:function(template){if(template){toggleButton.check(0);}else{toggleButton.check(1);}}};}();